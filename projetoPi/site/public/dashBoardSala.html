<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="script/modal.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="js/funcoes.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" />
    <title>DashBoard</title>
    <link
      rel="shortcut icon"
      href="assets/Img_Icon_Logo.png"
      type="image/x-icon" />
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/dashBoard.css" />
    <link rel="stylesheet" href="css/dashBoardSala.css" />
    <script src="js/kpis.js"></script>
  </head>
  <body>
    <header>
      <nav class="container">
        <span class="span-logo"
          ><h1>Fleming</h1>
          <img
            class="img-logo-gota"
            src="assets/Img_Icon_Logo.png"
            alt="logoGotas"
        /></span>

        <ul class="navbar">
          <li>
            <a href="#" style="color: black">Salas</a>
            <ul>
              <li><a href="">Sala01</a></li>
              <li><a href="">Sala02</a></li>
              <li><a href="">Sala03</a></li>
              <li><a href="">Sala04</a></li>
              <li><a href="">Sala05</a></li>
              <li><a href="">Sala06</a></li>
              <li><a href="">Sala07</a></li>
              <li><a href="">Sala08</a></li>
              <li><a href="">Sala09</a></li>
              <li><a href="">Sala10</a></li>
            </ul>
          </li>
          <li>
            <a href="#">Laboratórios</a>
            <ul>
              <li><a href="dashBoardLabnova.html">Laboratório01</a></li>
              <li><a href="dashBoardLabnova.html">Laboratório02</a></li>
              <li><a href="dashBoardLabnova.html">Laboratório03</a></li>
              <li><a href="dashBoardLabnova.html">Laboratório04</a></li>
              <li><a href="dashBoardLabnova.html">Laboratório05</a></li>
            </ul>
          </li>
          <li><a href="dashBoardnova.html">Home</a></li>
          <a href="#">
            <a href="#" id="nome_user"></a>
            <li>
              <img src="assets/Img_User.svg" alt="" />
              <ul>
                <li>
                  <a
                    href="https://app.pipefy.com/public/form/VUNJN1lE"
                    style="font-size: 0.7vw; padding: 5px"
                    >Solicitar chamado</a
                  >
                </li>
                <li>
                  <a
                    href="#"
                    onclick="limparSessao()"
                    style="font-size: 0.7vw; padding: 5px"
                    ><i class="fa-solid fa-arrow-right-from-bracket"></i>
                    Sair</a
                  >
                </li>
              </ul>
            </li></a
          >
        </ul>
      </nav>
    </header>
    <section class="container section-container section-container">
      <div class="containerDash">
        <div class="containerKPI">
          <div class="legenda">
            <div class="legendaAlertas">
              <div class="legendaAler padrao">
                <div class="card">
                  <div class="imgAler">
                    <img src="assets/Img_Term_AltaUmidade1.svg" alt="" />
                  </div>
                  <div class="textAler">
                    <p>Alerta alta umidade. 62%</p>
                  </div>
                </div>
              </div>
              <div class="legendaAler padrao">
                <div class="card">
                  <div class="imgAler">
                    <img src="assets/Img_Term_AceitavelUmidade.svg" alt="" />
                  </div>
                  <div class="textAler">
                    <p>Umidade aceitável. 46%</p>
                  </div>
                </div>
              </div>
              <div class="legendaAler padrao">
                <div class="card">
                  <div class="imgAler">
                    <img src="assets/Img_Term_BaixaUmidade1.svg" alt="" />
                  </div>
                  <div class="textAler">
                    <p>Alerta baixa umidade. 43%</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="legendaAlertas">
              <div class="legendaAler padrao">
                <div class="card">
                  <div class="imgAler">
                    <img src="assets/Img_Term_AltaUmidade2.svg" alt="" />
                  </div>
                  <div class="textAler">
                    <p>Emergência alta umidade. 64%</p>
                  </div>
                </div>
              </div>
              <div class="legendaAler padrao">
                <div class="card">
                  <div class="imgAler">
                    <img src="assets/Img_Term_UmidadeIdeal.svg" alt="" />
                  </div>
                  <div class="textAler">
                    <p>Umidade controlada. Ideal 53% a 52%</p>
                  </div>
                </div>
              </div>
              <div class="legendaAler padrao">
                <div class="card">
                  <div class="imgAler">
                    <img src="assets/Img_Term_BaixaUmidade2.svg" alt="" />
                  </div>
                  <div class="textAler">
                    <p>Emergência baixa umidade. 41%</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="legendaAlertas">
              <div class="legendaAler padrao">
                <div class="card">
                  <div class="imgAler">
                    <img src="assets/Img_Term_AltaUmidade.svg" alt="" />
                  </div>
                  <div class="textAler">
                    <p>Alerta crítico alta umidade. 65%</p>
                  </div>
                </div>
              </div>
              <div class="legendaAler padrao">
                <div class="card">
                  <div class="imgAler">
                    <img src="assets/Img_Term_AceitavelUmidade.svg" alt="" />
                  </div>
                  <div class="textAler">
                    <p>Umidade aceitável. 59%</p>
                  </div>
                </div>
              </div>
              <div class="legendaAler padrao">
                <div class="card">
                  <div class="imgAler">
                    <img src="assets/Img_Term_BaixaUmidade.svg" alt="" />
                  </div>
                  <div class="textAler">
                    <p>Alerta crítico baixa umidade. 40%</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="kpis">
            <div class="kpi padrao" onclick="acao()" style="cursor: pointer">
              <div class="containerKPI2">
                <div class="textKPI">
                  <h1 class="title title2">Máxima umidade no dia</h1>
                </div>
                <div class="imgKPI">
                  <img src="assets/Img_Term_AltaUmidade1.svg" alt="" id="imgMax" />
                </div>
                <h1 class="title title2"><span id="valorMax"></span></h1>
                <div class="text2KPI">
                  <p class="textLegenda title2"><span id="areaMax"></span></p>
                </div>
              </div>
            </div>
            <div class="kpi padrao" onclick="acao()" style="cursor: pointer">
              <div class="containerKPI2">
                <div class="textKPI">
                  <h1 class="title title2">Mínima umidade no dia</h1>
                </div>
                <div class="imgKPI">
                  <img src="assets/Img_Term_UmidadeIdeal.svg" alt="" id="imgMin"/>
                </div>
                <h1 class="title title2"><span id="valorMin"></span></h1>
                <div class="text2KPI">
                  <p class="textLegenda title2"><span id="areaMin"></span></p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="modal">
        <div onclick="fechar()" class="fechar">
          <img src="assets/Img_close.svg" alt="" />
        </div>
        <div class="containerModal">
          <div class="imgSalas">
            <img src="assets/Img_SalaDeProdução.svg" alt="" />
          </div>
        </div>
      </div>
    </section>
    <section class="container section-container cont-graf">
      <div class="containerGraficosSala">
        <div class="cardGraficos">
          <h2 class="title" style="font-size: 1.5vw">
            Monitoramento da umidade nas áreas localizadas na sala de produção
            (período de 45Min)
          </h2>
          <div class="avisoCaptura">
            <p id="avisoCaptura" class="title" style="font-size: 1vw"></p>
          </div>
        </div>
      </div>
      <div class="containerGrafico">
        <div class="container-Graf">
          <div class="chart-container" style="height: 35vh; width: 35vw">
            <canvas id="myChart" style="height: 25vh; width: 25vw"></canvas>
          </div>
          <div class="chart-container" style="height: 35vh; width: 35vw">
            <canvas id="myChart2" style="height: 25vh; width: 25vw"></canvas>
          </div>
        </div>
        <div class="container-Graf">
          <div class="chart-container" style="height: 35vh; width: 35vw">
            <canvas id="myChart3" style="height: 25vh; width: 25vw"></canvas>
          </div>
          <div class="chart-container" style="height: 35vh; width: 35vw">
            <canvas id="myChart4" style="height: 25vh; width: 25vw"></canvas>
          </div>
        </div>
      </div>
    </section>
    <section class="container section-container cont-graf">
      <div class="container-Graf">
        <div class="chart-container" style="height: 38vh; width: 38vw">
          <canvas id="myChart5" style="height: 25vh; width: 25vw"></canvas>
        </div>
      </div>
      <div class="containerGraficosSala">
        <div class="cardGraficos" style="margin-top: 80px">
          <h2 class="title">
            Áreas com umidade fora do aceitável no momento. <br />
            Tempo em que as áreas estiveram fora do aceitável.(período Min)
          </h2>
          <h2 class="title">Área A, Área B, Área C</h2>
          <p class="titleGraf">Umidade aceitável entre 46% a 59%</p>
        </div>
        <div class="container-Graf">
          <div class="chart-container" style="height: 45vh; width: 45vw">
            <canvas id="myChart7"></canvas>
          </div>
        </div>
      </div>
    </section>
    <section class="container section-container">
      <div class="containerGraficosSala">
        <div class="cardGraficos">
          <h2 class="title">
            Variação da umidade nas áreas da sala de produção (período de 24H)
          </h2>
          <p class="titleGraf">Variação deve ser de até no máximo 5</p>
        </div>
        <div class="container-Graf">
          <div class="chart-container" style="height: 45vh; width: 45vw">
            <canvas id="myChart6"></canvas>
          </div>
        </div>
      </div>
    </section>
  </body>
</html>
<script>
  window.onload = umidadeMax();
  window.onload = umidadeMin();
  const labels6 = ["22/10/2022", "23/10/2022"];
  const data6 = {
    labels: labels6,
    datasets: [
      {
        label: "Área A",
        backgroundColor: "#00FF66",
        borderColor: "#00FF66",
        data: [53, 50],
      },
      {
        label: "Área B",
        backgroundColor: "#084B99",
        borderColor: "#084B99",
        data: [48, 60],
      },
      {
        label: "Área C",
        backgroundColor: "#40C89F",
        borderColor: "#40C89F",
        data: [47, 50],
      },
      {
        label: "Área D",
        backgroundColor: "#B5D0E0",
        borderColor: "#B5D0E0",
        data: [67, 60],
      },
      {
        label: "Área E",
        backgroundColor: "#345E77",
        borderColor: "#345E77",
        data: [55, 50],
      },
    ],
  };
  const config6 = {
    type: "bar",
    data: data6,
    options: {},
  };
</script>
<script>
  const myChart6 = new Chart(document.getElementById("myChart6"), config6);
</script>

<script>
  function mostrandoGrafico() {
  
  const labels7 = ["Área A", "Área B", "Área C", "Área D", "Área E"];
  const data7 = {
    labels: labels7,
    datasets: [
      {
        label: "Tempo em que a área ficou fora do padrão (min)",
        data: [contador1,contador2,contador3,contador4,contador5],
        backgroundColor: ["rgba(66, 120, 152, 0.6)"],
        borderColor: ["rgb(66, 120, 152)"],
        borderWidth: 1,
      },
    ],
  };

  const config7 = {
    type: "bar",
    data: data7,
    options: {
      scales: {
        y: {
          beginAtZero: true,
        },
      },
    },
  };

  const myChart7 = new Chart(document.getElementById("myChart7"), config7);
}
</script>

<!-- Script Gráficos com API -->
<script>
  nome_user.innerHTML = `Olá, ` + sessionStorage.NOME_USUARIO;

  let proximaAtualizacao;

  window.onload = obterDadosGrafico(1);

  // O gráfico é construído com três funções:
  // 1. obterDadosGrafico -> Traz dados do Banco de Dados para montar o gráfico da primeira vez
  // 2. plotarGrafico -> Monta o gráfico com os dados trazidos e exibe em tela
  // 3. atualizarGrafico -> Atualiza o gráfico, trazendo novamente dados do Banco

  // Esta função *obterDadosGrafico* busca os últimos dados inseridos em tabela de medidas.
  // para, quando carregar o gráfico da primeira vez, já trazer com vários dados.
  // A função *obterDadosGrafico* também invoca a função *plotarGrafico*

  //     Se quiser alterar a busca, ajuste as regras de negócio em src/controllers
  //     Para ajustar o "select", ajuste o comando sql em src/models
  var temp1;
  var temp2;
  var temp3;
  var temp4;
  var temp5;
  function obterDadosGrafico(idSala) {
    if (proximaAtualizacao != undefined) {
      clearTimeout(proximaAtualizacao);
    }

    fetch(`/medidas/ultimas/${idSala}`, { cache: "no-store" })
      .then(function (response) {
        if (response.ok) {
          response.json().then(function (resposta) {
            console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
            resposta.reverse();

            plotarGrafico(resposta, idSala);
          });
        } else {
          console.error("Nenhum dado encontrado ou erro na API");
        }
      })
      .catch(function (error) {
        console.error(
          `Erro na obtenção dos dados p/ gráfico: ${error.message}`
        );
      });
  }

  // Esta função *plotarGrafico* usa os dados capturados na função anterior para criar o gráfico
  // Configura o gráfico (cores, tipo, etc), materializa-o na página e,
  // A função *plotarGrafico* também invoca a função *atualizarGrafico*
  function plotarGrafico(resposta, idSala) {
    console.log("iniciando plotagem do gráfico...");

    // Criando estrutura para plotar gráfico - labels
    let labels = [];

    // Criando estrutura para plotar gráfico - dados
    let dados = {
      labels: labels,
      datasets: [
        {
          label: "Umidade Área A",
          data: [],
          fill: false,
          backgroundColor: "rgba(66, 120, 152, 0.6)",
          borderColor: "rgb(66, 120, 152)",
          tension: 0.1,
        },
      ],
    };

    console.log("----------------------------------------------");
    console.log(
      'Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGrafico":'
    );
    console.log(resposta);

    // Inserindo valores recebidos em estrutura para plotar o gráfico
    for (i = 0; i < resposta.length; i++) {
      var registro = resposta[i];
      labels.push(registro.momento_grafico);
      dados.datasets[0].data.push(registro.umidade);
    }

    console.log("----------------------------------------------");
    console.log("O gráfico será plotado com os respectivos valores:");
    console.log("Labels:");
    console.log(labels);
    console.log("Dados:");
    console.log(dados.datasets);
    console.log("----------------------------------------------");

    // Criando estrutura para plotar gráfico - config
    const config = {
      type: "line",
      data: dados,
    };

    // Adicionando gráfico criado em div na tela
    let myChart = new Chart(document.getElementById("myChart"), config);

    setTimeout(() => atualizarGrafico(idSala, dados, myChart), 2000);
  }

  // Esta função *atualizarGrafico* atualiza o gráfico que foi renderizado na página,
  // buscando a última medida inserida em tabela contendo as capturas,

  //     Se quiser alterar a busca, ajuste as regras de negócio em src/controllers
  //     Para ajustar o "select", ajuste o comando sql em src/models
  function atualizarGrafico(idSala, dados, myChart) {
    fetch(`/medidas/tempo-real/${idSala}`, { cache: "no-store" })
      .then(function (response) {
        if (response.ok) {
          response.json().then(function (novoRegistro) {
            console.log(`Dados recebidos: ${JSON.stringify(novoRegistro)}`);
            console.log(`Dados atuais do gráfico:`);
            console.log(dados);
            temp1 = novoRegistro[novoRegistro.length-1].umidade;
            document.getElementById("avisoCaptura").innerHTML = "";

            if (
              novoRegistro[0].momento_grafico ==
              dados.labels[dados.labels.length - 1]
            ) {
              console.log(
                "---------------------------------------------------------------"
              );
              console.log(
                "Como não há dados novos para captura, o gráfico não atualizará."
              );
              document.getElementById("avisoCaptura").innerHTML =
                "<i class='fa-solid fa-triangle-exclamation'></i> Foi trazido o dado mais atual capturado pelo sensor. <br> Como não há dados novos a exibir, o gráfico não atualizará.";
              console.log("Horário do novo dado capturado:");
              console.log(novoRegistro[0].momento_grafico);
              console.log("Horário do último dado capturado:");
              console.log(dados.labels[dados.labels.length - 1]);
              console.log(
                "---------------------------------------------------------------"
              );
            } else {
              // tirando e colocando valores no gráfico
              dados.labels.shift(); // apagar o primeiro
              dados.labels.push(novoRegistro[0].momento_grafico); // incluir um novo momento

              dados.datasets[0].data.shift(); // apagar o primeiro de umidade
              dados.datasets[0].data.push(novoRegistro[0].umidade); // incluir uma nova medida de umidade
              myChart.update();
            }

            // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
            proximaAtualizacao = setTimeout(
              () => atualizarGrafico(idSala, dados, myChart),
              2000
            );
          });
        } else {
          console.error("Nenhum dado encontrado ou erro na API");
          // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
          proximaAtualizacao = setTimeout(
            () => atualizarGrafico(idSala, dados, myChart),
            2000
          );
        }
      })
      .catch(function (error) {
        console.error(
          `Erro na obtenção dos dados p/ gráfico: ${error.message}`
        );
      });
  }
</script>
<!-- Script Gráficos com API -->
<script>
  window.onload = obterDadosGrafico2(1);

  // O gráfico é construído com três funções:
  // 1. obterDadosGrafico -> Traz dados do Banco de Dados para montar o gráfico da primeira vez
  // 2. plotarGrafico -> Monta o gráfico com os dados trazidos e exibe em tela
  // 3. atualizarGrafico -> Atualiza o gráfico, trazendo novamente dados do Banco

  // Esta função *obterDadosGrafico* busca os últimos dados inseridos em tabela de medidas.
  // para, quando carregar o gráfico da primeira vez, já trazer com vários dados.
  // A função *obterDadosGrafico* também invoca a função *plotarGrafico*

  //     Se quiser alterar a busca, ajuste as regras de negócio em src/controllers
  //     Para ajustar o "select", ajuste o comando sql em src/models
  function obterDadosGrafico2(idSala) {
    if (proximaAtualizacao != undefined) {
      clearTimeout(proximaAtualizacao);
    }

    fetch(`/medidas/ultimasB/${idSala}`, { cache: "no-store" })
      .then(function (response) {
        if (response.ok) {
          response.json().then(function (resposta) {
            console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
            resposta.reverse();

            plotarGrafico2(resposta, idSala);
          });
        } else {
          console.error("Nenhum dado encontrado ou erro na API");
        }
      })
      .catch(function (error) {
        console.error(
          `Erro na obtenção dos dados p/ gráfico: ${error.message}`
        );
      });
  }

  // Esta função *plotarGrafico* usa os dados capturados na função anterior para criar o gráfico
  // Configura o gráfico (cores, tipo, etc), materializa-o na página e,
  // A função *plotarGrafico* também invoca a função *atualizarGrafico*
  function plotarGrafico2(resposta, idSala) {
    console.log("iniciando plotagem do gráfico...");

    // Criando estrutura para plotar gráfico - labels
    let labels = [];

    // Criando estrutura para plotar gráfico - dados
    let dados = {
      labels: labels,
      datasets: [
        {
          label: "Umidade Área B",
          data: [],
          fill: false,
          backgroundColor: "rgba(66, 120, 152, 0.6)",
          borderColor: "rgb(66, 120, 152)",
          tension: 0.1,
        },
      ],
    };

    console.log("----------------------------------------------");
    console.log(
      'Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGrafico":'
    );
    console.log(resposta);

    // Inserindo valores recebidos em estrutura para plotar o gráfico
    for (i = 0; i < resposta.length; i++) {
      var registro = resposta[i];
      labels.push(registro.momento_grafico);
      dados.datasets[0].data.push(registro.umidade);
    }

    console.log("----------------------------------------------");
    console.log("O gráfico será plotado com os respectivos valores:");
    console.log("Labels:");
    console.log(labels);
    console.log("Dados:");
    console.log(dados.datasets);
    console.log("----------------------------------------------");

    // Criando estrutura para plotar gráfico - config
    const config2 = {
      type: "line",
      data: dados,
    };

    // Adicionando gráfico criado em div na tela
    let myChart2 = new Chart(document.getElementById("myChart2"), config2);

    setTimeout(() => atualizarGrafico2(idSala, dados, myChart2), 2000);
  }

  // Esta função *atualizarGrafico* atualiza o gráfico que foi renderizado na página,
  // buscando a última medida inserida em tabela contendo as capturas,

  //     Se quiser alterar a busca, ajuste as regras de negócio em src/controllers
  //     Para ajustar o "select", ajuste o comando sql em src/models
  function atualizarGrafico2(idSala, dados, myChart2) {
    fetch(`/medidas/tempo-realB/${idSala}`, { cache: "no-store" })
      .then(function (response) {
        if (response.ok) {
          response.json().then(function (novoRegistro) {
            console.log(`Dados recebidos: ${JSON.stringify(novoRegistro)}`);
            console.log(`Dados atuais do gráfico:`);
            console.log(dados);
            temp2 = novoRegistro[novoRegistro.length-1].umidade;
            document.getElementById("avisoCaptura").innerHTML = "";

            if (
              novoRegistro[0].momento_grafico ==
              dados.labels[dados.labels.length - 1]
            ) {
              console.log(
                "---------------------------------------------------------------"
              );
              console.log(
                "Como não há dados novos para captura, o gráfico não atualizará."
              );
              document.getElementById("avisoCaptura").innerHTML =
                "<i class='fa-solid fa-triangle-exclamation'></i> Foi trazido o dado mais atual capturado pelo sensor. <br> Como não há dados novos a exibir, o gráfico não atualizará.";
              console.log("Horário do novo dado capturado:");
              console.log(novoRegistro[0].momento_grafico);
              console.log("Horário do último dado capturado:");
              console.log(dados.labels[dados.labels.length - 1]);
              console.log(
                "---------------------------------------------------------------"
              );
            } else {
              // tirando e colocando valores no gráfico
              dados.labels.shift(); // apagar o primeiro
              dados.labels.push(novoRegistro[0].momento_grafico); // incluir um novo momento

              dados.datasets[0].data.shift(); // apagar o primeiro de umidade
              dados.datasets[0].data.push(novoRegistro[0].umidade); // incluir uma nova medida de umidade
              myChart2.update();
            }

            // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
            proximaAtualizacao = setTimeout(
              () => atualizarGrafico2(idSala, dados, myChart2),
              2000
            );
          });
        } else {
          console.error("Nenhum dado encontrado ou erro na API");
          // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
          proximaAtualizacao = setTimeout(
            () => atualizarGrafico2(idSala, dados, myChart2),
            2000
          );
        }
      })
      .catch(function (error) {
        console.error(
          `Erro na obtenção dos dados p/ gráfico: ${error.message}`
        );
      });
  }
</script>

<script>
  window.onload = obterDadosGrafico3(1);

  // O gráfico é construído com três funções:
  // 1. obterDadosGrafico -> Traz dados do Banco de Dados para montar o gráfico da primeira vez
  // 2. plotarGrafico -> Monta o gráfico com os dados trazidos e exibe em tela
  // 3. atualizarGrafico -> Atualiza o gráfico, trazendo novamente dados do Banco

  // Esta função *obterDadosGrafico* busca os últimos dados inseridos em tabela de medidas.
  // para, quando carregar o gráfico da primeira vez, já trazer com vários dados.
  // A função *obterDadosGrafico* também invoca a função *plotarGrafico*

  //     Se quiser alterar a busca, ajuste as regras de negócio em src/controllers
  //     Para ajustar o "select", ajuste o comando sql em src/models
  function obterDadosGrafico3(idSala) {
    if (proximaAtualizacao != undefined) {
      clearTimeout(proximaAtualizacao);
    }

    fetch(`/medidas/ultimasC/${idSala}`, { cache: "no-store" })
      .then(function (response) {
        if (response.ok) {
          response.json().then(function (resposta) {
            console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
            resposta.reverse();

            plotarGrafico3(resposta, idSala);
          });
        } else {
          console.error("Nenhum dado encontrado ou erro na API");
        }
      })
      .catch(function (error) {
        console.error(
          `Erro na obtenção dos dados p/ gráfico: ${error.message}`
        );
      });
  }

  // Esta função *plotarGrafico* usa os dados capturados na função anterior para criar o gráfico
  // Configura o gráfico (cores, tipo, etc), materializa-o na página e,
  // A função *plotarGrafico* também invoca a função *atualizarGrafico*
  function plotarGrafico3(resposta, idSala) {
    console.log("iniciando plotagem do gráfico...");

    // Criando estrutura para plotar gráfico - labels
    let labels = [];

    // Criando estrutura para plotar gráfico - dados
    let dados = {
      labels: labels,
      datasets: [
        {
          label: "Umidade Área C",
          data: [],
          fill: false,
          backgroundColor: "rgba(66, 120, 152, 0.6)",
          borderColor: "rgb(66, 120, 152)",
          tension: 0.1,
        },
      ],
    };

    console.log("----------------------------------------------");
    console.log(
      'Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGrafico":'
    );
    console.log(resposta);

    // Inserindo valores recebidos em estrutura para plotar o gráfico
    for (i = 0; i < resposta.length; i++) {
      var registro = resposta[i];
      labels.push(registro.momento_grafico);
      dados.datasets[0].data.push(registro.umidade);
    }

    console.log("----------------------------------------------");
    console.log("O gráfico será plotado com os respectivos valores:");
    console.log("Labels:");
    console.log(labels);
    console.log("Dados:");
    console.log(dados.datasets);
    console.log("----------------------------------------------");

    // Criando estrutura para plotar gráfico - config
    const config3 = {
      type: "line",
      data: dados,
    };

    // Adicionando gráfico criado em div na tela
    let myChart3 = new Chart(document.getElementById("myChart3"), config3);

    setTimeout(() => atualizarGrafico3(idSala, dados, myChart3), 2000);
  }

  // Esta função *atualizarGrafico* atualiza o gráfico que foi renderizado na página,
  // buscando a última medida inserida em tabela contendo as capturas,

  //     Se quiser alterar a busca, ajuste as regras de negócio em src/controllers
  //     Para ajustar o "select", ajuste o comando sql em src/models
  function atualizarGrafico3(idSala, dados, myChart3) {
    fetch(`/medidas/tempo-realC/${idSala}`, { cache: "no-store" })
      .then(function (response) {
        if (response.ok) {
          response.json().then(function (novoRegistro) {
            console.log(`Dados recebidos: ${JSON.stringify(novoRegistro)}`);
            console.log(`Dados atuais do gráfico:`);
            console.log(dados);
            temp3 = novoRegistro[novoRegistro.length-1].umidade;
            document.getElementById("avisoCaptura").innerHTML = "";

            if (
              novoRegistro[0].momento_grafico ==
              dados.labels[dados.labels.length - 1]
            ) {
              console.log(
                "---------------------------------------------------------------"
              );
              console.log(
                "Como não há dados novos para captura, o gráfico não atualizará."
              );
              document.getElementById("avisoCaptura").innerHTML =
                "<i class='fa-solid fa-triangle-exclamation'></i> Foi trazido o dado mais atual capturado pelo sensor. <br> Como não há dados novos a exibir, o gráfico não atualizará.";
              console.log("Horário do novo dado capturado:");
              console.log(novoRegistro[0].momento_grafico);
              console.log("Horário do último dado capturado:");
              console.log(dados.labels[dados.labels.length - 1]);
              console.log(
                "---------------------------------------------------------------"
              );
            } else {
              // tirando e colocando valores no gráfico
              dados.labels.shift(); // apagar o primeiro
              dados.labels.push(novoRegistro[0].momento_grafico); // incluir um novo momento

              dados.datasets[0].data.shift(); // apagar o primeiro de umidade
              dados.datasets[0].data.push(novoRegistro[0].umidade); // incluir uma nova medida de umidade
              myChart3.update();
            }

            // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
            proximaAtualizacao = setTimeout(
              () => atualizarGrafico3(idSala, dados, myChart3),
              2000
            );
          });
        } else {
          console.error("Nenhum dado encontrado ou erro na API");
          // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
          proximaAtualizacao = setTimeout(
            () => atualizarGrafico3(idSala, dados, myChart3),
            2000
          );
        }
      })
      .catch(function (error) {
        console.error(
          `Erro na obtenção dos dados p/ gráfico: ${error.message}`
        );
      });
  }
</script>
<script>
  window.onload = obterDadosGrafico4(1);

  // O gráfico é construído com três funções:
  // 1. obterDadosGrafico -> Traz dados do Banco de Dados para montar o gráfico da primeira vez
  // 2. plotarGrafico -> Monta o gráfico com os dados trazidos e exibe em tela
  // 3. atualizarGrafico -> Atualiza o gráfico, trazendo novamente dados do Banco

  // Esta função *obterDadosGrafico* busca os últimos dados inseridos em tabela de medidas.
  // para, quando carregar o gráfico da primeira vez, já trazer com vários dados.
  // A função *obterDadosGrafico* também invoca a função *plotarGrafico*

  //     Se quiser alterar a busca, ajuste as regras de negócio em src/controllers
  //     Para ajustar o "select", ajuste o comando sql em src/models
  function obterDadosGrafico4(idSala) {
    if (proximaAtualizacao != undefined) {
      clearTimeout(proximaAtualizacao);
    }

    fetch(`/medidas/ultimasD/${idSala}`, { cache: "no-store" })
      .then(function (response) {
        if (response.ok) {
          response.json().then(function (resposta) {
            console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
            resposta.reverse();
            // temp4 = resposta[resposta.length-1].umidade;
            plotarGrafico4(resposta, idSala);

          });
        } else {
          console.error("Nenhum dado encontrado ou erro na API");
        }
      })
      .catch(function (error) {
        console.error(
          `Erro na obtenção dos dados p/ gráfico: ${error.message}`
        );
      });
      
  }

  // Esta função *plotarGrafico* usa os dados capturados na função anterior para criar o gráfico
  // Configura o gráfico (cores, tipo, etc), materializa-o na página e,
  // A função *plotarGrafico* também invoca a função *atualizarGrafico*
  function plotarGrafico4(resposta, idSala) {
    console.log("iniciando plotagem do gráfico...");

    // Criando estrutura para plotar gráfico - labels
    let labels = [];

    // Criando estrutura para plotar gráfico - dados
    let dados = {
      labels: labels,
      datasets: [
        {
          label: "Umidade Área D",
          data: [],
          fill: false,
          backgroundColor: "rgba(66, 120, 152, 0.6)",
          borderColor: "rgb(66, 120, 152)",
          tension: 0.1,
        },
      ],
    };

    console.log("----------------------------------------------");
    console.log(
      'Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGrafico":'
    );
    console.log(resposta);

    // Inserindo valores recebidos em estrutura para plotar o gráfico
    for (i = 0; i < resposta.length; i++) {
      var registro = resposta[i];
      labels.push(registro.momento_grafico);
      dados.datasets[0].data.push(registro.umidade);
    }

    console.log("----------------------------------------------");
    console.log("O gráfico será plotado com os respectivos valores:");
    console.log("Labels:");
    console.log(labels);
    console.log("Dados:");
    console.log(dados.datasets);
    console.log("----------------------------------------------");

    // Criando estrutura para plotar gráfico - config
    const config4 = {
      type: "line",
      data: dados,
    };

    // Adicionando gráfico criado em div na tela
    let myChart4 = new Chart(document.getElementById("myChart4"), config4);

    setTimeout(() => atualizarGrafico4(idSala, dados, myChart4), 2000);
  }

  // Esta função *atualizarGrafico* atualiza o gráfico que foi renderizado na página,
  // buscando a última medida inserida em tabela contendo as capturas,

  //     Se quiser alterar a busca, ajuste as regras de negócio em src/controllers
  //     Para ajustar o "select", ajuste o comando sql em src/models
  function atualizarGrafico4(idSala, dados, myChart4) {
    fetch(`/medidas/tempo-realD/${idSala}`, { cache: "no-store" })
      .then(function (response) {
        if (response.ok) {
          response.json().then(function (novoRegistro) {
            console.log(`Dados recebidos: ${JSON.stringify(novoRegistro)}`);
            console.log(`Dados atuais do gráfico:`);
            console.log(dados);
            temp4 = novoRegistro[novoRegistro.length-1].umidade;
            
            
            document.getElementById("avisoCaptura").innerHTML = "";

            if (
              novoRegistro[0].momento_grafico ==
              dados.labels[dados.labels.length - 1]
            ) {
              console.log(
                "---------------------------------------------------------------"
              );
              console.log(
                "Como não há dados novos para captura, o gráfico não atualizará."
              );
              document.getElementById("avisoCaptura").innerHTML =
                "<i class='fa-solid fa-triangle-exclamation'></i> Foi trazido o dado mais atual capturado pelo sensor. <br> Como não há dados novos a exibir, o gráfico não atualizará.";
              console.log("Horário do novo dado capturado:");
              console.log(novoRegistro[0].momento_grafico);
              console.log("Horário do último dado capturado:");
              console.log(dados.labels[dados.labels.length - 1]);
              console.log(
                "---------------------------------------------------------------"
              );
            } else {
              // tirando e colocando valores no gráfico
              dados.labels.shift(); // apagar o primeiro
              dados.labels.push(novoRegistro[0].momento_grafico); // incluir um novo momento

              dados.datasets[0].data.shift(); // apagar o primeiro de umidade
              dados.datasets[0].data.push(novoRegistro[0].umidade); // incluir uma nova medida de umidade
              myChart4.update();
            }

            // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
            proximaAtualizacao = setTimeout(
              () => atualizarGrafico4(idSala, dados, myChart4),
              2000
            );
          });
        } else {
          console.error("Nenhum dado encontrado ou erro na API");
          // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
          proximaAtualizacao = setTimeout(
            () => atualizarGrafico4(idSala, dados, myChart4),
            2000
          );
        }
      })
      .catch(function (error) {
        console.error(
          `Erro na obtenção dos dados p/ gráfico: ${error.message}`
        );
      });
  }
</script>
<script>
  window.onload = obterDadosGrafico5(1);

  // O gráfico é construído com três funções:
  // 1. obterDadosGrafico -> Traz dados do Banco de Dados para montar o gráfico da primeira vez
  // 2. plotarGrafico -> Monta o gráfico com os dados trazidos e exibe em tela
  // 3. atualizarGrafico -> Atualiza o gráfico, trazendo novamente dados do Banco

  // Esta função *obterDadosGrafico* busca os últimos dados inseridos em tabela de medidas.
  // para, quando carregar o gráfico da primeira vez, já trazer com vários dados.
  // A função *obterDadosGrafico* também invoca a função *plotarGrafico*

  //     Se quiser alterar a busca, ajuste as regras de negócio em src/controllers
  //     Para ajustar o "select", ajuste o comando sql em src/models
  
  function obterDadosGrafico5(idSala) {
    if (proximaAtualizacao != undefined) {
      clearTimeout(proximaAtualizacao);
    }

    fetch(`/medidas/ultimasE/${idSala}`, { cache: "no-store" })
      .then(function (response) {
        if (response.ok) {
          response.json().then(function (resposta) {
            console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
            resposta.reverse();

            plotarGrafico5(resposta, idSala);
          });
        } else {
          console.error("Nenhum dado encontrado ou erro na API");
        }
      })
      .catch(function (error) {
        console.error(
          `Erro na obtenção dos dados p/ gráfico: ${error.message}`
        );
      });
  }

  // Esta função *plotarGrafico* usa os dados capturados na função anterior para criar o gráfico
  // Configura o gráfico (cores, tipo, etc), materializa-o na página e,
  // A função *plotarGrafico* também invoca a função *atualizarGrafico*
  function plotarGrafico5(resposta, idSala) {
    console.log("iniciando plotagem do gráfico...");

    // Criando estrutura para plotar gráfico - labels
    let labels = [];

    // Criando estrutura para plotar gráfico - dados
    let dados = {
      labels: labels,
      datasets: [
        {
          label: "Umidade Área E",
          data: [],
          fill: false,
          backgroundColor: "rgba(66, 120, 152, 0.6)",
          borderColor: "rgb(66, 120, 152)",
          tension: 0.1,
        },
      ],
    };

    console.log("----------------------------------------------");
    console.log(
      'Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGrafico":'
    );
    console.log(resposta);

    // Inserindo valores recebidos em estrutura para plotar o gráfico
    for (i = 0; i < resposta.length; i++) {
      var registro = resposta[i];
      labels.push(registro.momento_grafico);
      dados.datasets[0].data.push(registro.umidade);
    }

    console.log("----------------------------------------------");
    console.log("O gráfico será plotado com os respectivos valores:");
    console.log("Labels:");
    console.log(labels);
    console.log("Dados:");
    console.log(dados.datasets);
    console.log("----------------------------------------------");

    // Criando estrutura para plotar gráfico - config
    const config5 = {
      type: "line",
      data: dados,
    };

    // Adicionando gráfico criado em div na tela
    let myChart5 = new Chart(document.getElementById("myChart5"), config5);

    setTimeout(() => atualizarGrafico5(idSala, dados, myChart5), 2000);
  }

  // Esta função *atualizarGrafico* atualiza o gráfico que foi renderizado na página,
  // buscando a última medida inserida em tabela contendo as capturas,

  //     Se quiser alterar a busca, ajuste as regras de negócio em src/controllers
  //     Para ajustar o "select", ajuste o comando sql em src/models
  function atualizarGrafico5(idSala, dados, myChart5) {
    fetch(`/medidas/tempo-realE/${idSala}`, { cache: "no-store" })
      .then(function (response) {
        if (response.ok) {
          response.json().then(function (novoRegistro) {
            console.log(`Dados recebidos: ${JSON.stringify(novoRegistro)}`);
            console.log(`Dados atuais do gráfico:`);
            console.log(dados);
            temp5 = novoRegistro[novoRegistro.length-1].umidade;
            // alert(`${temp1} / ${temp2} / ${temp3} / ${temp4} / ${temp5}`);
            tempoAlerta();
            document.getElementById("avisoCaptura").innerHTML = "";

            if (
              novoRegistro[0].momento_grafico ==
              dados.labels[dados.labels.length - 1]
            ) {
              console.log(
                "---------------------------------------------------------------"
              );
              console.log(
                "Como não há dados novos para captura, o gráfico não atualizará."
              );
              document.getElementById("avisoCaptura").innerHTML =
                "<i class='fa-solid fa-triangle-exclamation'></i> Foi trazido o dado mais atual capturado pelo sensor. <br> Como não há dados novos a exibir, o gráfico não atualizará.";
              console.log("Horário do novo dado capturado:");
              console.log(novoRegistro[0].momento_grafico);
              console.log("Horário do último dado capturado:");
              console.log(dados.labels[dados.labels.length - 1]);
              console.log(
                "---------------------------------------------------------------"
              );
            } else {
              // tirando e colocando valores no gráfico
              dados.labels.shift(); // apagar o primeiro
              dados.labels.push(novoRegistro[0].momento_grafico); // incluir um novo momento

              dados.datasets[0].data.shift(); // apagar o primeiro de umidade
              dados.datasets[0].data.push(novoRegistro[0].umidade); // incluir uma nova medida de umidade
              myChart5.update();
            }

            // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
            proximaAtualizacao = setTimeout(
              () => atualizarGrafico5(idSala, dados, myChart5),
              2000
            );
          });
        } else {
          console.error("Nenhum dado encontrado ou erro na API");
          // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
          proximaAtualizacao = setTimeout(
            () => atualizarGrafico5(idSala, dados, myChart5),
            2000
          );
        }
      })
      .catch(function (error) {
        console.error(
          `Erro na obtenção dos dados p/ gráfico: ${error.message}`
        );
      });
  }

</script>

